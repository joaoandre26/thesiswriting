\cleardoublepage
\chapter{Hardware}
% To do: 
% Color Scheme
% Red - Not started
% Yellow - In progress
% Blue - Done, under approval
% Green - Done and approved
\todo[inline,color=red!40]{*Latter add Section for the actuator}
\todo[inline,color=red!40]{*Chapter Introduction}
\todo[inline,color=red!40]{*1 - Selection}
\todo[inline,color=red!40]{ a) Microphone}
\todo[inline,color=red!40]{ b) Accelerometer}
\todo[inline,color=red!40]{ c) Piezoelectric}
\todo[inline,color=red!40]{*2 - Design}
\todo[inline,color=red!40]{ a) Accelerometer}
\todo[inline,color=red!40]{ b) Piezoelectric}
\todo[inline,color=red!40]{*3 - Capture/Coupling}
\todo[inline,color=red!40]{ a) Microphone}
\todo[inline,color=red!40]{ b) Accelerometer}
\todo[inline,color=red!40]{ c) Piezoelectric}
%% Writing %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Selection}
\subsection{Microphone}
With the interest of understand what is the system response to a external stimulation, it is needed a simple method to record that response. The easy way to do that is by using a microphone to capture the sound produced, when hitting the side surface of the LPG bottle, by the time the study of this started due to the fact there wasn't available the proper material for it, in the case a microphone and a soundboard, lead to search for an alternative for it. Although there is various alternatives for it, like the embedded computer microphone, or a external microphone, none of those were able to properly capture the sound and be mounted in a practical setup, the alternative for this solution is recurring to the used of the microphone of a regular phone. The phone itself is connected via USB to the computer, on which additional software was installed to allow to access in real time to the data captured by the microphone of the phone. In figure \ref{fig:MicConnectio} is a illustration of the connection between the microphone of the phone and the computer.
\begin{figure}[!htb]
    \centering
    %\includegraphics[width=0.65\textwidth]{Chapters/3CHP/Images/WOMICDiag.png}
    \caption{Physical connection of the phone microphone to the computer}
    \label{fig:MicConnectio}
\end{figure}
\subsection{Accelerometer}
As already mentioned in section \ref{sec:VibSens}, there are various types of accelerometers, however the choice of the one to use depends on various factors, for this particular application is important that the accelerometer in use has a low cost and a small size, for the future application. With this in mind the choice declines over MEMS accelerometers, that are smaller when compared with piezoelectric accelerometers.\\
The type of MEMS accelerometers available is very wide, some of them started to be used in applications that usually uses piezoelectric accelerometers, like condition-based monitoring (CBM), structural health monitoring (SHM), asset health monitoring (AHM), vital sign monitoring (VSM) and IoT, for example. When selecting the accelerometer is important to take into consideration some parameters, which are responsible to determine the category of the accelerometer, they are the application, the bandwidth and the range. Although there is no standard for the category on each accelerometer fits in, \textit{Analog Devices} has one document where they divide their products in different categories, with the type of application used in each on of them featuring a description of the key parameters that must be taken into consideration when selecting the appropriate accelerometer.
\begin{figure}[!htb]
    \centering
    \includegraphics[width=1\textwidth]{Chapters/3CHP/Images/adTable.pdf}
    \caption{Application landscape for a selection of Analog Devices MEMS accelerometers}
    \label{fig:adtable}
\end{figure}
The MEMS accelerometers from \textit{Analog Devices} are divided in two families, the ADXLxxxx and the ADIS16xxxx, the last offers different advantages when compared with he first, more like a plug-and-play solution with features like factory compensation, embedded compensation and signal processing. This family obviously has one of the features that has particular interest for the application, in this case the fact that has signal processing on the accelerometer, on the other hand this comes with a price, and this family of products has a higher cost. So is necessary to define the key specifications of the accelerometer, in order to properly chose one\cite{AnalogDialogue51102017}\cite{AnalogDialogue51112017}.\\
The final purpose is to have a cheap and portable prototype, that is capable of accurately measure the vibrations and determine the the liquid level, this implies that his bandwidth covers the spectrum of frequency on which the curve of the relation liquid level vs frequency is. With this the key specifications are the low cost, low power and his bandwidth must close to 2kHz, determine as maximum frequency for a mechanical vibrations in \ref{tab:sampRat} and latter proved in the results obtained by \citeauthor{wuLiquidLevelDetector2014b} as described in \ref{sec:LPGModel}. Considering these specification, some models where chosen, that integrate this criteria, as follows:
\begin{table}
    \centering
    \includegraphics[width=1\textwidth]{Chapters/3CHP/Images/accTable.pdf}
    \caption{Key specifications of MEMS accelerometers}
    \label{fig:acctable}
\end{table}
Although is doesn't accommodate entirely the specifications but since it was already available for use, the choice fell to the ADXL335. This model offers a low power consumption of around 350$\mu$A, his bandwidth is adjustable with a single capacitor per axis, from 0.5 to 1600 Hz for X and Y axis and 0.5 to 550Hz for Z axis. Beside this the accelerometer itself is very cheap, with a price starting at 3â‚¬. To properly acquire the data from this sensor and process it, is necessary to integrate it with a amplifier circuit and a microcontroller, on which more details will be explain further ahead.
\subsection{Piezoelectric}
To what concerns in the choice of a piezoelectric sensor, although there are very types of this kind of transducers and there are various applications for them.  
\subsection{Microcontroller}
When selecting the microcontroller, is important to have some specifications in mind, as in the perspective of a future implementation, one that is quite important is the performance, the cost, as well as the power consumption. There is a large variety of products that most certainly would fit in these specifications. The selection of this it took in consideration those characteristics and fell to one from Texas-Instruments, the model of the chosen microcontroller is the MSP-EXP430FR2433, his main characteristics are the following:
\begin{itemize}
    \item 16-bit RISC processor with a clock frequency up to 16MHz;
    \item 15KB of program and 512B information FRAM, 4KB RAM;
    \item 8-channel 10-bit ADC;
    \item Four 16-bit Timers, 16-bit counter-only RTC;
    \item 32-bit Hardware-Multiplier;
    \item Two eUSCI\_A, supports UART, IrDA and SPI and one eUSCI\_B, supports SPI and I2C;
\end{itemize}
Beside these characteristics the microcontroller offers different low-power modes, that consume from hundreds of microAmps to a couple of hundreds of microAmps, depending on the mode of operation of the microcontroller. Another thing in consideration, when selecting, is the fact that is possible to run with a super cap. The performance in this case is not as important as it seams, is not mandatory that operation that would need to be performed must return a liquid level to the user instantly, that means that the results not being in real time won't make much of a difference, anyway if that was the case, there is also a 32-bit Hardware-Multiplier embedded that reduces the use of CPU time to perform multiplications that would be required.  
\section{Design}
\subsection{Accelerometer}
\subsection{Piezoelectric}
\section{Capture/Coupling}
\subsection{Microphone}
\subsection{Accelerometer}
\subsection{Piezoelectric}

\section{Extras - Delete later}
%\begin{gather}
%    \Delta_{10} = \frac{1-0}{2^{10}} \approx 0.98\cdot10^{-3}\\
%    \Delta_{8} = \frac{1-0}{2^{8}} \approx 3.9\cdot10^{-3}
%\end{gather}

%\begin{equation} \label{eq:maxf}
%    f_{Max} = \frac{1}{T-WNS} = \frac{1}{10\cdot 10^{-9} - 0.188\cdot 10^{-9}} = 101.9\,MHz
%\end{equation}

%\begin{itemize}
%    \item \textbf{AXI4} implements a highly customizable memory mapped interface, indicated for complex applications;
%    \item \textbf{AXI4-Lite} is a simplified version of the former, keeping the memory mapped communications;
%    \item \textbf{AXI4-Stream} implements a streaming protocol, allowing a high throughput.
%\end{itemize}

%\begin{figure}[!htb]
%    \centering
%    \includegraphics[width=\textwidth]{Sections/4DevelopedArchitecture/Figures/DCTCop.png}
%    \caption{Block design generated by \emph{Vivado} for integration of \emph{DCT Wrapper} with \emph{Microblaze}.}
%    \label{fig:blockdes}
%\end{figure}

%\begin{table}[!htpb]
%    \centering
%    \caption{Add Caption}
%    \begin{tabular}{ccccc} \toprule
%        {}&{}&{}&{}&{}\\
%        \bottomrule
%    \end{tabular}    
    %\label{tab:maxfps}
%\end{table}


\clearpage
%\printbibliography[heading=subbibliography]
%\addcontentsline{toc}{section}{References}